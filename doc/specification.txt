                JTAG REQUIREMENTS SPECIFICATION DOCUMENT
               ******************************************


DOCUMENT HISTORY:
-- $Log: specification.txt,v $
-- Revision 1.2  2003-06-13 20:44:54  scottl
-- Fixes and corrections based on discussion with Sam
--
-- Revision 1.1.1.1  2003/06/11 17:52:21  scottl
-- Initial Version
--


1. INTRODUCTION
---------------

1.1 Purpose: 
    This document is intended to capture all specifications and
    functionality required of a software application used to identify and
    tag various components of scanned journal articles.

1.2 Overview:
    The jtag application software will be designed with the goal of allowing a
    user to load and display scanned image representations of journal articles
    so that different portions can be selected and classified by the user.  
    These portions will include (but are not limited to) body text, equations, 
    images, headers, tables, titles, and page numbers etc.  By keeping track 
    of these classifications, we should then be able to build up a corpus of 
    data that can be used to train a computer to automatically classify 
    new journal articles into various components.

    The machine learning algorithms used to automatically classify the 
    components of a journal image page will be rolled into a separate 
    application which jtag will interact with.  The jtag application will
    send the journal currently being displayed to this application for 
    automatic classification, then interpret the results from that application
    to display to the user the classifications it predicted.  The user can then 
    look through the classified journal and make any necessary corrections 
    manually.  The user can also choose to turn off classification suggestions
    and make their own classifications without aid of the external application.


2. MAJOR FUNCTIONALITY
----------------------

2.1 Display image representations of scanned journal articles
    * should handle various image formats (tiff, jpg, bmp, etc.)
      - Use Img package since it supports all of the above transparently
    * should have the ability to zoom in/out of the displayed image
    * provide scrollbars to navigate over portions of the image if it is
      too large to fit in the window
    * must be able to flip between pages in multiple page images (note that
      separate functionality will be provided to break up such images into 
      multiple files -- see 2.7)

2.2 Select and "Crop" any portion of the displayed journal with the mouse
    * work with quadrilaterals only
    * 2 different modes:
      - typical "crop" to make a complete bounding box
      - simple horizontal selection.  Bound by page width to create bounding
        box
    * ability to redo or refine selection
    * ensure that selections are unique, and that no pixels are classified
      two or more times
    * store x,y co-ords of selection.  Since always square, need 4 #'s
      x_left, x_right, y_min, y_max.  Use UNIX conv. 0,0 = top left corner
    * store time to make each selection + time to classify selection (move it
      to a bucket) by timestamping each event
    * display cropped selection in default colour (black) until it has
      been classified (moved to a bucket)

2.3 Classify selected portion
    * "buckets" around document setup so that selections can be dragged over
       them (each bucket represents a different journal component)
    * bucket border width should change when a selection can be placed over
      it (selection itself will be a small icon)
    * must be able to configure (add/remove) buckets (through config file on
      startup only)
    * use of colour coding for each bucket/selection
    * ability to reclassify selections.  Make a classified selection active by
      clicking on it, then drag to a new bucket to reclassify.
    * store number of times selection was reclassified (user changed bucket)
    * Must save selections between iterations of opening and closing file
      (See section 5)

2.4 Display selections made
    * Should be able to display all selections made so far
    * Will use colour coding to show what each selection has been classified as

2.5 Read in Configuration Data from a file on startup
    * on program startup look in current directory, then $HOME for a file
      named .jconfig
    * if not found, load some default set of config options
    * Data in config file will include:
      - list of valid classification types and their associated colour
      - default selection mode (crop vs. simple)
      - default output directory / filename suffix
      - turn on/off look-ahead feature (see 2.8)

2.6 Store current classifications efficiently in memory, dump to file on
    save/exit
    * When user changes active selection, must be able to retrieve the 
      selection based on where user clicks with mouse
    * Write to disk in order of top left corner pos, x value, then y value
    * See section 5 for output file format

2.7 Break multiple page images (single file), into a series of single page
    images (multiple files)
    * Make use of tiffinfo to determine if file contains multiple pages
    * calls to tiffsplit (plus a prefix stored in config file) can do the
      actual breaking apart

2.8 Use selections made in previous pages, to look ahead and predict tags
    for future pages.
    * feature not required in initial version, but will be implemented in time
    * will make use of calls to helper application


3. CONSTRAINTS
--------------

3.1 Platform / Software / Libraries
    * Must run on CSLab machines (Red Hat Linux)
    * Write in Tcl/Tk
      - Will require Img package (for displaying tiff files)
      - Img in turn requires libtiff.so
    *? Others??

3.2 Must save selections between invocations of program on given file
    * Make use of output file, written to disk on program termination.  See 
      section 5
    * Look for such a file upon program startup.  If found, load selections
      on to image to be displayed


4. CONFIGURATION FILE FORMAT
----------------------------

4.1 File Name
    * .jconfig

4.2 Location
    * Will be searched for in current directory, and if not found, in $HOME
    * If not found at either place, a default configuration will be loaded

4.3 Contents
    * All leading blank characters (space/tab/newline) will be discarded
      when processing a line
    * Any line with a '#' character will be treated as a comment, and have
      all characters after it on the same line discarded

    4.3.1 Header Info
    *? Anything necessary??

    4.3.2 Body Info
    * First line will contain 'def_mode=' followed by a string representing
      the default mode.  Valid values are "crop" or "simple"
    * Next lines will contain a 'classifiers=[' followed by a list of 
      classification types, each of which has an '=' followed by a colour
      representing what colour selections of that type will be displayed as.
      Each list item is comma separated and may span multiple 
      lines.  End when closing ']' is reached.  Each classification type 
      is a string representing what a portion of the journal may be.  e.x.
           classifiers=[text=blue,
                          equation=red,
                   title=green,
                       graph=orange   ]
    *? Other configuration attributes??


5. OUTPUT FILE FORMAT
---------------------

5.1 Name
    * <in_file_name_prefix>.jtag
    * <in_file_name_prefix>.jlog

5.2 Location
    * Same directory as input file

5.3 Contents
    * All leading blank characters (space/tab/newline) will be discarded
      when processing a line
    * Any line with a '#' character will be treated as a comment, and have
      all characters after it on the same line discarded

    5.3.1 Header Info
    * First line contains 'img=' followed by the associated image file name
    * Second line contains 'type=' followed by the image file type (tiff/bmp)
    * Third line contains 'resolution=' followed by the image resolution (in 
      pixels e.x. 640x480)
    * Fourth line contains 'cksum=' followed by a checksum of the associated 
      image file

    5.3.2 Body Info (.jtag file) Repeated 0 or more times -- each represents
      a single selection
    * First line contains a separator of '---'
    * Second line contains 'class=' followed by the classification type e.x. 
      text or title
    * Third line should contain 'pos=' followed by a series of 4 comma
      separated numbers representing selection co-ords (normalized by image
      resolution)
    * Fourth line should contain 'mode=' followed by a string representing the
      mode used ("crop" or "simple")
    * Fifth line contains 'colour=' followed by a string representing the
      colour used for the selection ("blue or "red" etc.)
    *? Anything else??

    5.3.3 Body Info (.jlog file) Repeated 0 or more times -- each represents
      a single selection
    * First line contains 'sel_time=' followed by a decimal number
      representing the time in seconds to make the final bounding box selection 
      This includes edit and refinement time.
    * Second line should contain 'class_attempts=' followed by a positive 
      integer representing the total number of classification attempts
      made (i.e. if placed in a bucket, then later changed to another).  Must
      be >= 1
    * Third line should contain class_time=' followed by the total time taken 
      to classify the selection (i.e. once bounding box created, the time 
      required to drag the selection over a bucket).  Must add time, each time 
      a selection is reclassified -- moved from one bucket to another
    *? Anything else??
